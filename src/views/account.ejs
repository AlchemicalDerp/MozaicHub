<%- include('partials/header') %>
<h2>Account</h2>
<section class="profile-header">
  <div class="avatar-stack">
    <% if (user.profileImagePath) { %>
      <img class="avatar-lg" src="/uploads/<%= user.profileImagePath %>" alt="Profile image" />
    <% } else { %>
      <div class="avatar-lg placeholder">MH</div>
    <% } %>
    <form class="inline-upload" method="post" action="/account/avatar" enctype="multipart/form-data">
      <label class="button secondary">
        Upload Avatar
        <input type="file" name="profileImage" accept="image/*" hidden />
      </label>
      <button type="submit">Save Avatar</button>
    </form>
  </div>
  <div class="profile-meta">
    <p class="muted">Logged in as</p>
    <h3><%= user.displayName %> (@<%= user.username %>)</h3>
    <p><%= user.email %></p>
  </div>
</section>
<section class="form-card">
  <h3>Profile</h3>
  <form method="post" action="/account/profile">
    <label>Display Name</label>
    <input type="text" name="displayName" value="<%= user.displayName %>" />
    <label>Username</label>
    <input type="text" name="username" value="<%= user.username %>" />
    <label>Email</label>
    <input type="email" name="email" value="<%= user.email %>" />
    <button type="submit">Save</button>
  </form>
</section>
<section class="form-card">
  <h3>Change Password</h3>
  <form method="post" action="/account/password">
    <label>New Password</label>
    <input type="password" name="password" required />
    <button type="submit">Update</button>
  </form>
</section>
<section class="form-card">
  <h3>Storage</h3>
  <div class="storage-bar">
    <div class="storage-used" style="width: <%= Math.min(100, (Number(user.storageUsedBytes)/Number(user.storageQuotaBytes))*100) %>%"></div>
  </div>
  <p><%= (Number(user.storageUsedBytes)/1024/1024/1024).toFixed(2) %> GB / <%= (Number(user.storageQuotaBytes)/1024/1024/1024).toFixed(2) %> GB used</p>
</section>
<section>
  <h3>Friend Requests</h3>
  <h4>Incoming</h4>
  <ul>
    <% user.receivedFriendRequests.forEach(req => { if (req.status === 'pending') { %>
      <li>From <%= req.fromUserId %>
        <form method="post" action="/friends/requests/<%= req.id %>/accept"><button type="submit">Accept</button></form>
        <form method="post" action="/friends/requests/<%= req.id %>/decline"><button type="submit">Decline</button></form>
      </li>
    <% }}) %>
  </ul>
</section>
<%- include('partials/footer') %>
